import{_ as N}from"./aAvnW0cC.js";import{_ as E}from"./CC6qCaaH.js";import{d as S,j as m,r as _,H as k,i as F,x as u,A as h,B as L,y as v,v as i,z as g,I as y,G as s,C as z,J as H,K,L as j,M as q,N as G,O as J,u as Q,P as W,F as X,Q as R}from"./C7iyw_If.js";import{M as w,L as d,u as Y,K as Z}from"./B3z0UGRw.js";import{_ as ee}from"./Cw7GgeXB.js";import"./DlAUqK2U.js";class te{static random(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}}class oe{static getDifferenceDays(e,t){const r=Math.abs(+e-+t);return Math.floor(r/(1e3*60*60*24))}}const se=v("div",{class:"bg-gradient-to-b from-transparent from-10% to-dark-bg to-100% h-1/2 w-full absolute left-0 bottom-0"},null,-1),ae=v("div",{class:"bg-gradient-to-l from-transparent from-10% to-dark-bg to-100% w-1/2 h-full absolute left-0 bottom-0"},null,-1),re={class:"text-4xl sm:text-6xl max-w-[500px] font-bold"},le={class:"max-w-[650px] text-lg line-clamp-3 sm:line-clamp-6"},ne={key:0},ie={key:1},ce={key:2},ue=S({__name:"moviePreview",props:{image:{},movie:{}},setup(a){const e=a,t=m(()=>e.movie.type==="FILM"?"Фильм":e.movie.type==="TV_SERIES"?"Сериал":e.movie.type==="MINI_SERIES"?"Мини-сериал":"Фильм или сериал"),r=_();return k(()=>{r.value&&(r.value.style.backgroundImage="url("+e.image+")")},()=>e.image),(P,l)=>{const c=F("router-link"),M=E;return i(),u("div",{ref_key:"posterHtmlEl",ref:r,class:"mb-10 relative bg-no-repeat bg-cover bg-center flex items-center w-full h-[65vh] sm:h-[90vh]"},[se,ae,h(M,{class:"relative z-10 flex flex-col gap-y-4 items-start"},{default:L(()=>[v("h1",re,g(e.movie.name),1),v("h2",le,g(e.movie.description),1),v("p",null,[e.movie.rating?(i(),u("span",ne,g(e.movie.rating)+" | ",1)):y("",!0),e.movie.year?(i(),u("span",ie,g(e.movie.year)+" | ",1)):y("",!0),e.movie.type?(i(),u("span",ce,g(s(t)),1)):y("",!0)]),h(c,{class:"px-3 py-2 rounded-md text-lg text-white border-2 border-[#4a6fb5] transition-colors hover:bg-[#4a6fb5]",to:`/watch/${e.movie.kinopoiskId}`},{default:L(()=>[z(" Смотреть онлайн ")]),_:1},8,["to"])]),_:1})],512)}}}),ve={class:"rounded-xl overflow-hidden flex items-stretch gap-x-1"},pe=["value"],me={class:"block p-4 border-black"},de=S({__name:"movieSelector",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(a){const e=_([{key:w.TOP_POPULAR_ALL,name:"Все"},{key:w.TOP_POPULAR_MOVIES,name:"Фильмы"},{key:w.POPULAR_SERIES,name:"Сериалы"}]),t=H(a,"modelValue");return(r,P)=>(i(),u("div",ve,[(i(!0),u(K,null,j(s(e),l=>(i(),u("label",{class:"has-[:checked]:bg-[#304c7a] block bg-[#4a6fb5] cursor-pointer transition-colors",key:l.key},[q(v("input",{"onUpdate:modelValue":P[0]||(P[0]=c=>t.value=c),class:"appearance-none absolute",value:l.key,type:"radio"},null,8,pe),[[G,t.value]]),v("span",me,g(l.name),1)]))),128))]))}}),_e=J("preview",{state:()=>({previewMovie:d.get("previewMovie")||null,previewMoviePoster:d.get("previewPoster")||null,lastUpdate:d.get("lastUpdatePreview")}),actions:{setPreviewMovie(a,e){const t=Date.now();console.log("movie -> ",a),this.previewMovie=a,this.previewMoviePoster=e,this.lastUpdate=t,d.set("previewMovie",a),d.set("previewPoster",e),d.set("lastUpdatePreview",t)}}}),fe={class:"flex flex-col items-center gap-y-5"},xe=S({__name:"index",setup(a){const e=Q(),t=Y(),r=_e(),P=new Z,l=_(""),c=m(()=>t.finalMovieList),M=m(()=>t.loaded),V=m(()=>r.previewMovie),U=m(()=>r.previewMoviePoster),p=_(w.TOP_POPULAR_ALL),D=m(()=>p.value===w.TOP_POPULAR_MOVIES?"Популярные фильмы":p.value===w.POPULAR_SERIES?"Популярные сериалы":"Популярные фильмы и сериалы"),f=_(1),x=_(!1),T=m(()=>t.totalPages),I=async()=>{const n=c.value[te.random(1,20)];if(!n)return;const o=await P.getMovieImages(n.kinopoiskId);if(o.length<1){await I();return}r.setPreviewMovie(n,o[0].imageUrl)},O=_(!1);k(async()=>{const n=d.get("lastUpdatePreview")||null,o=n?oe.getDifferenceDays(new Date,n):!0;!O.value&&c.value.length&&o&&(O.value=!0,await I())},()=>c.value),k(()=>[p.value,f.value],(n,o)=>{if(o&&o[0]!==n[0]&&f.value>1&&(x.value=!0,f.value=1),x.value){x.value=!1;return}t.loadFilms(p.value,f.value)},{immediate:!0});const A=()=>{e.push({path:"/search",query:{s:l.value}})},$=()=>{T.value!==f.value&&f.value++};return W(()=>{l.value=""}),(n,o)=>{const C=N,B=E;return i(),u("div",null,[s(V)&&s(U)?(i(),X(ue,{key:0,movie:s(V),image:s(U)},null,8,["movie","image"])):y("",!0),h(B,null,{default:L(()=>[v("section",fe,[h(C,{class:"w-full sm:w-1/2",modelValue:s(l),"onUpdate:modelValue":o[0]||(o[0]=b=>R(l)?l.value=b:null),onSearch:A},null,8,["modelValue"]),h(de,{modelValue:s(p),"onUpdate:modelValue":o[1]||(o[1]=b=>R(p)?p.value=b:null)},null,8,["modelValue"]),h(ee,{"is-loaded":s(M),class:"self-stretch",title:s(D),"movie-list":s(c),onPagination:$},null,8,["is-loaded","title","movie-list"])])]),_:1})])}}});export{xe as default};
