import{_ as J}from"./CRcCj_M-.js";import{_ as T}from"./UItERm5_.js";import{H as D,d as $,j as p,r as u,I as L,i as z,x as v,A as g,B as S,y as d,v as r,z as h,J as y,G as i,C as H,K,L as j,M as G,N as Q,O as W,u as X,P as Y,F as Z,Q as R}from"./CUVRfy3p.js";import{u as ee,L as f}from"./099bz77x.js";import{_ as te}from"./PVgXkuaE.js";import{k as oe,M as w,K as se}from"./CHcXnI8s.js";import"./DlAUqK2U.js";class ae{static random(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}}class ie{static getDifferenceDays(e,t){const o=Math.abs(+e-+t);return Math.floor(o/(1e3*60*60*24))}}function E(s){const e=s.map(o=>JSON.stringify(o));return[...new Set(e)].map(o=>JSON.parse(o))}const le=D("main",{state:()=>({movieList:[],totalPages:0,loaded:!1,collectionType:null}),getters:{finalMovieList(s){const t=ee().favoriteList.map(o=>o.kinopoiskId);return s.movieList.map(o=>t.includes(o.kinopoiskId)?{...o,favorite:!0}:{...o,favorite:!1})}},actions:{loadFilms(s,e){if(e===this.$state.totalPages||this.$state.loaded)return;const t=this.$state.collectionType!==s;this.$state.loaded=!0,t&&(this.$state.movieList=[]),oe.getCollections(e,s).then(o=>{this.$state.movieList=E([...this.$state.movieList,...o.items]),this.$state.totalPages=o.totalPages,this.$state.movieList=E([...this.$state.movieList,...o.items]),t&&(this.$state.collectionType=s)}).finally(()=>{this.$state.loaded=!1})}}}),ne=d("div",{class:"bg-gradient-to-b from-transparent from-10% to-dark-bg to-100% h-1/2 w-full absolute left-0 bottom-0"},null,-1),re=d("div",{class:"bg-gradient-to-l from-transparent from-10% to-dark-bg to-100% w-1/2 h-full absolute left-0 bottom-0"},null,-1),ce={class:"text-4xl sm:text-6xl max-w-[500px] font-bold line-clamp-2"},ue={class:"max-w-[650px] text-lg line-clamp-3 sm:line-clamp-6"},ve={key:0},de={key:1},me={key:2},pe=$({__name:"moviePreview",props:{image:{},movie:{}},setup(s){const e=s,t=p(()=>e.movie.type==="FILM"?"Фильм":e.movie.type==="TV_SERIES"?"Сериал":e.movie.type==="MINI_SERIES"?"Мини-сериал":"Фильм или сериал"),o=u();return L(()=>{o.value&&(o.value.style.backgroundImage="url("+e.image+")")},()=>e.image),(P,l)=>{const c=z("router-link"),k=T;return r(),v("div",{ref_key:"posterHtmlEl",ref:o,class:"mb-10 relative bg-no-repeat bg-cover bg-center flex items-center w-full h-[65vh] sm:h-[90vh]"},[ne,re,g(k,{class:"relative z-10 flex flex-col gap-y-4 items-start"},{default:S(()=>[d("h1",ce,h(e.movie.name),1),d("h2",ue,h(e.movie.description),1),d("p",null,[e.movie.rating?(r(),v("span",ve,h(e.movie.rating)+" | ",1)):y("",!0),e.movie.year?(r(),v("span",de,h(e.movie.year)+" | ",1)):y("",!0),e.movie.type?(r(),v("span",me,h(i(t)),1)):y("",!0)]),g(c,{class:"px-3 py-2 rounded-md text-lg text-white border-2 border-[#4a6fb5] transition-colors hover:bg-[#4a6fb5]",to:`/watch/${e.movie.kinopoiskId}`},{default:S(()=>[H(" Смотреть онлайн ")]),_:1},8,["to"])]),_:1})],512)}}}),fe={class:"rounded-xl overflow-hidden flex items-stretch gap-x-1"},_e=["value"],he={class:"block p-4 border-black"},ge=$({__name:"movieSelector",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(s){const e=u([{key:w.TOP_POPULAR_ALL,name:"Все"},{key:w.TOP_POPULAR_MOVIES,name:"Фильмы"},{key:w.POPULAR_SERIES,name:"Сериалы"}]),t=K(s,"modelValue");return(o,P)=>(r(),v("div",fe,[(r(!0),v(j,null,G(i(e),l=>(r(),v("label",{class:"has-[:checked]:bg-[#304c7a] block bg-[#4a6fb5] cursor-pointer transition-colors",key:l.key},[Q(d("input",{"onUpdate:modelValue":P[0]||(P[0]=c=>t.value=c),class:"appearance-none absolute",value:l.key,type:"radio"},null,8,_e),[[W,t.value]]),d("span",he,h(l.name),1)]))),128))]))}}),we=D("preview",{state:()=>({previewMovie:f.get("previewMovie")||null,previewMoviePoster:f.get("previewPoster")||null,lastUpdate:f.get("lastUpdatePreview")||null}),actions:{setPreviewMovie(s,e){const t=Date.now();this.previewMovie=s,this.previewMoviePoster=e,this.lastUpdate=t,f.set("previewMovie",s),f.set("previewPoster",e),f.set("lastUpdatePreview",t)}}}),Pe={class:"flex flex-col items-center gap-y-5"},$e=$({__name:"index",setup(s){const e=X(),t=le(),o=we(),P=new se,l=u(""),c=p(()=>t.finalMovieList),k=p(()=>t.loaded),M=u(!1),I=p(()=>o.previewMovie),O=p(()=>o.previewMoviePoster),m=u(w.TOP_POPULAR_ALL),A=p(()=>m.value===w.TOP_POPULAR_MOVIES?"Популярные фильмы":m.value===w.POPULAR_SERIES?"Популярные сериалы":"Популярные фильмы и сериалы"),_=u(1),x=u(!1),C=p(()=>t.totalPages),V=async()=>{const n=c.value[ae.random(1,20)];if(!n)return;const a=await P.getMovieImages(n.kinopoiskId);if(a.length<1){await V();return}o.setPreviewMovie(n,a[0].imageUrl)},U=u(!1);L(async()=>{const n=f.get("lastUpdatePreview")||null,a=n?ie.getDifferenceDays(new Date,n):!0;!U.value&&c.value.length&&a&&(U.value=!0,await V())},()=>c.value),L(()=>[m.value,_.value],(n,a)=>{if(a&&a[0]!==n[0]&&_.value>1&&(x.value=!0,_.value=1),x.value){x.value=!1;return}M.value=!0,t.loadFilms(m.value,_.value),M.value=!1},{immediate:!0});const N=()=>{e.push({path:"/search",query:{s:l.value}})},B=()=>{C.value!==_.value&&_.value++};return Y(()=>{l.value=""}),(n,a)=>{const F=J,q=T;return r(),v("div",null,[i(I)&&i(O)?(r(),Z(pe,{key:0,movie:i(I),image:i(O)},null,8,["movie","image"])):y("",!0),g(q,null,{default:S(()=>[d("section",Pe,[g(F,{class:"w-full sm:w-1/2",modelValue:i(l),"onUpdate:modelValue":a[0]||(a[0]=b=>R(l)?l.value=b:null),onSearch:N},null,8,["modelValue"]),g(ge,{modelValue:i(m),"onUpdate:modelValue":a[1]||(a[1]=b=>R(m)?m.value=b:null)},null,8,["modelValue"]),g(te,{"is-loaded":i(k),class:"self-stretch",title:i(A),"movie-list":i(c),onPagination:B,"pagination-loaded":i(M)},null,8,["is-loaded","title","movie-list","pagination-loaded"])])]),_:1})])}}});export{$e as default};
