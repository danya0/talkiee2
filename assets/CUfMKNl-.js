import{_ as z}from"./RkD7Bj2f.js";import{_ as D}from"./DtwTpYJt.js";import{H as C,d as O,j as p,r as u,I as S,i as H,x as m,A as w,B as $,y as v,v as r,z as g,J as M,G as i,C as K,K as j,L as G,M as Q,N as W,O as X,u as Y,P as Z,F as ee,Q as E}from"./B1l5Ij2e.js";import{L as f}from"./DXt85jR_.js";import{_ as te}from"./B-dyQwc4.js";import{s as se,S as _}from"./C1-eom0i.js";import{k as oe,M as P,K as ae}from"./D_sfbCPW.js";import"./DlAUqK2U.js";class ie{static random(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}}class le{static getDifferenceDays(e,t){const s=Math.abs(+e-+t);return Math.floor(s/(1e3*60*60*24))}}function T(o){const e=o.map(s=>JSON.stringify(s));return[...new Set(e)].map(s=>JSON.parse(s))}const ne=C("main",{state:()=>({movieList:[],totalPages:0,loaded:!1,collectionType:null}),getters:{finalMovieList(o){return se(o.movieList)}},actions:{loadFilms(o,e){if(e===this.$state.totalPages||this.$state.loaded)return;const t=this.$state.collectionType!==o;this.$state.loaded=!0,t&&(this.$state.movieList=[]),oe.getCollections(e,o).then(s=>{this.$state.movieList=T([...this.$state.movieList,...s.items]),this.$state.totalPages=s.totalPages,this.$state.movieList=T([...this.$state.movieList,...s.items]),t&&(this.$state.collectionType=o)}).finally(()=>{this.$state.loaded=!1})}}}),re=v("div",{class:"bg-gradient-to-b from-transparent from-10% to-dark-bg to-100% h-1/2 w-full absolute left-0 bottom-0"},null,-1),ce=v("div",{class:"bg-gradient-to-l from-transparent from-10% to-dark-bg to-100% w-1/2 h-full absolute left-0 bottom-0"},null,-1),ue={class:"text-4xl sm:text-6xl max-w-[500px] font-bold line-clamp-2"},me={class:"max-w-[650px] text-lg line-clamp-3 sm:line-clamp-6"},ve={key:0},de={key:1},pe={key:2},fe=O({__name:"moviePreview",props:{image:{},movie:{}},setup(o){const e=o,t=p(()=>e.movie.type==="FILM"?"Фильм":e.movie.type==="TV_SERIES"?"Сериал":e.movie.type==="MINI_SERIES"?"Мини-сериал":"Фильм или сериал"),s=u();return S(()=>{s.value&&(s.value.style.backgroundImage="url("+e.image+")")},()=>e.image),(y,l)=>{const c=H("router-link"),k=D;return r(),m("div",{ref_key:"posterHtmlEl",ref:s,class:"mb-10 relative bg-no-repeat bg-cover bg-center flex items-center w-full h-[65vh] sm:h-[90vh]"},[re,ce,w(k,{class:"relative z-10 flex flex-col gap-y-4 items-start"},{default:$(()=>[v("h1",ue,g(e.movie.name),1),v("h2",me,g(e.movie.description),1),v("p",null,[e.movie.rating?(r(),m("span",ve,g(e.movie.rating)+" | ",1)):M("",!0),e.movie.year?(r(),m("span",de,g(e.movie.year)+" | ",1)):M("",!0),e.movie.type?(r(),m("span",pe,g(i(t)),1)):M("",!0)]),w(c,{class:"px-3 py-2 rounded-md text-lg text-white border-2 border-[#4a6fb5] transition-colors hover:bg-[#4a6fb5]",to:`/watch/${e.movie.kinopoiskId}`},{default:$(()=>[K(" Смотреть онлайн ")]),_:1},8,["to"])]),_:1})],512)}}}),_e={class:"rounded-xl overflow-hidden flex items-stretch gap-x-1"},he=["value"],ge={class:"block p-4 border-black"},we=O({__name:"movieSelector",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(o){const e=u([{key:P.TOP_POPULAR_ALL,name:"Все"},{key:P.TOP_POPULAR_MOVIES,name:"Фильмы"},{key:P.POPULAR_SERIES,name:"Сериалы"}]),t=j(o,"modelValue");return(s,y)=>(r(),m("div",_e,[(r(!0),m(G,null,Q(i(e),l=>(r(),m("label",{class:"has-[:checked]:bg-[#304c7a] block bg-[#4a6fb5] cursor-pointer transition-colors",key:l.key},[W(v("input",{"onUpdate:modelValue":y[0]||(y[0]=c=>t.value=c),class:"appearance-none absolute",value:l.key,type:"radio"},null,8,he),[[X,t.value]]),v("span",ge,g(l.name),1)]))),128))]))}}),Pe=C("preview",{state:()=>({previewMovie:f.get(_.previewMovie)||null,previewMoviePoster:f.get(_.previewPoster)||null,lastUpdate:f.get(_.lastUpdatePreview)||null}),actions:{setPreviewMovie(o,e){const t=Date.now();this.previewMovie=o,this.previewMoviePoster=e,this.lastUpdate=t,f.set(_.previewMovie,o),f.set(_.previewPoster,e),f.set(_.lastUpdatePreview,t)}}}),ye={class:"flex flex-col items-center gap-y-5"},Ve=O({__name:"index",setup(o){const e=Y(),t=ne(),s=Pe(),y=new ae,l=u(""),c=p(()=>t.finalMovieList),k=p(()=>t.loaded),x=u(!1),V=p(()=>s.previewMovie),U=p(()=>s.previewMoviePoster),d=u(P.TOP_POPULAR_ALL),A=p(()=>d.value===P.TOP_POPULAR_MOVIES?"Популярные фильмы":d.value===P.POPULAR_SERIES?"Популярные сериалы":"Популярные фильмы и сериалы"),h=u(1),b=u(!1),N=p(()=>t.totalPages),I=async()=>{const n=c.value[ie.random(1,20)];if(!n)return;const a=await y.getMovieImages(n.kinopoiskId);if(a.length<1){await I();return}s.setPreviewMovie(n,a[0].imageUrl)},R=u(!1);S(async()=>{const n=f.get(_.lastUpdatePreview)||null,a=n?le.getDifferenceDays(new Date,n):!0;!R.value&&c.value.length&&a&&(R.value=!0,await I())},()=>c.value),S(()=>[d.value,h.value],(n,a)=>{if(a&&a[0]!==n[0]&&h.value>1&&(b.value=!0,h.value=1),b.value){b.value=!1;return}x.value=!0,t.loadFilms(d.value,h.value),x.value=!1},{immediate:!0});const B=()=>{e.push({path:"/search",query:{s:l.value}})},F=()=>{N.value!==h.value&&h.value++};return Z(()=>{l.value=""}),(n,a)=>{const q=z,J=D;return r(),m("div",null,[i(V)&&i(U)?(r(),ee(fe,{key:0,movie:i(V),image:i(U)},null,8,["movie","image"])):M("",!0),w(J,null,{default:$(()=>[v("section",ye,[w(q,{class:"w-full sm:w-1/2",modelValue:i(l),"onUpdate:modelValue":a[0]||(a[0]=L=>E(l)?l.value=L:null),onSearch:B},null,8,["modelValue"]),w(we,{modelValue:i(d),"onUpdate:modelValue":a[1]||(a[1]=L=>E(d)?d.value=L:null)},null,8,["modelValue"]),w(te,{"is-loaded":i(k),class:"self-stretch",title:i(A),"movie-list":i(c),onPagination:F,"pagination-loaded":i(x)},null,8,["is-loaded","title","movie-list","pagination-loaded"])])]),_:1})])}}});export{Ve as default};
