import{_ as R}from"./CRcCj_M-.js";import{_ as N}from"./UItERm5_.js";import{H as T,d as g,v as n,x as h,L as V,M as b,y as S,z as q,R as F,u as A,r as m,j as l,S as M,I as j,F as H,B as z,A as k,G as a,Q as D,J as L}from"./CUVRfy3p.js";import{_ as E}from"./PVgXkuaE.js";import{k as G}from"./CHcXnI8s.js";import{L as f,u as J}from"./099bz77x.js";import"./DlAUqK2U.js";const K=10,Q=T("search",{state:()=>({searchList:[],searchListTotalPages:0,loaded:!1,searchHistory:f.get("searchHistory")||[]}),getters:{finalSearchList(o){const s=J().favoriteList.map(e=>e.kinopoiskId);return o.searchList.map(e=>s.includes(e.kinopoiskId)?{...e,favorite:!0}:{...e,favorite:!1})}},actions:{clearHistory(){this.searchHistory=[],f.removeItem("searchHistory")},writeToHistory(o){const t=this.searchHistory.findIndex(s=>s===o);if(t!==-1){this.searchHistory.push(...this.searchHistory.splice(t,1));return}this.searchHistory.length>=K&&this.searchHistory.shift(),this.searchHistory.push(o),f.set("searchHistory",this.searchHistory)},findByName(o,t){const s=o.trim();this.$state.loaded=!0,t===1&&(this.$state.searchList=[]),G.getByKeyword(s,t).then(e=>{this.$state.searchList=[...this.$state.searchList,...e.items],this.$state.searchListTotalPages=Math.ceil(e.searchFilmsCountResult/t),this.writeToHistory(s),this.$state.loaded=!1})}}}),U={class:"flex flex-wrap items-center gap-x-1 gap-y-1 mb-6"},O=S("span",null,"–ù–µ–¥–∞–≤–Ω–æ –∏—Å–∫–∞–ª–∏:",-1),W=["onClick"],X=g({__name:"SearchHistory",props:{history:{}},emits:["clearHistory","research"],setup(o,{emit:t}){const s=t;return(e,r)=>(n(),h("div",U,[O,(n(!0),h(V,null,b(e.history,i=>(n(),h("span",{key:i,class:"text-white/70 inline-block hover:underline py-1 px-2 rounded-md bg-black/40 cursor-pointer",onClick:u=>s("research",i)},q(i),9,W))),128)),S("span",{class:"underline cursor-pointer text-white/80",onClick:r[0]||(r[0]=i=>s("clearHistory"))}," –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é ")]))}}),Y={key:1,class:"text-3xl xl:text-4xl text-center"},ie=g({__name:"index",setup(o){const t=F(),s=A(),e=m(""),r=Q(),i=l(()=>r.finalSearchList),u=l(()=>t.query.s),y=l(()=>r.loaded),p=m(!1),c=m(0),$=l(()=>r.searchListTotalPages),_=l(()=>r.searchHistory.toReversed());M(()=>{u.value&&(e.value=`${u.value}`,d())});const d=()=>{e.value.trim()&&(c.value=1,p.value=!0,s.push({query:{...t.query,s:e.value}}))},w=v=>{e.value=v,d()};j(()=>[c.value,u.value],()=>{r.findByName(e.value,c.value)});const C=()=>{$.value<=c.value||c.value++};return(v,x)=>{const B=R,I=N;return n(),H(I,{class:"pt-24 flex flex-col items-center"},{default:z(()=>[k(B,{class:"w-full sm:w-1/2 mb-6",modelValue:a(e),"onUpdate:modelValue":x[0]||(x[0]=P=>D(e)?e.value=P:null),onSearch:d},null,8,["modelValue"]),a(_).length?(n(),H(X,{key:0,history:a(_),onClearHistory:a(r).clearHistory,onResearch:w},null,8,["history","onClearHistory"])):L("",!0),k(E,{class:"self-stretch","movie-list":a(i),"is-loaded":a(y),onPagination:C},null,8,["movie-list","is-loaded"]),!a(i).length&&!a(y)&&a(p)?(n(),h("div",Y," –ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üò¢ ")):L("",!0)]),_:1})}}});export{ie as default};
