import{_ as F}from"./7LgbAimh.js";import{_ as R}from"./Cv1mPJWV.js";import{H as E,d as S,j as d,r as f,I as b,i as q,x as u,A as g,B as L,y as v,v as n,z as h,J as y,G as r,C as J,K as z,L as H,M as K,N as j,O as G,u as Q,P as W,F as X,Q as U}from"./CFQ_Fs7C.js";import{u as Y,L as p}from"./Cw9DUKrr.js";import{_ as Z}from"./DpUXKYii.js";import{k as ee,M as w,K as te}from"./CdpP0kGF.js";import"./DlAUqK2U.js";class oe{static random(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}}class se{static getDifferenceDays(e,t){const o=Math.abs(+e-+t);return Math.floor(o/(1e3*60*60*24))}}function ae(s){const e=s.map(o=>JSON.stringify(o));return[...new Set(e)].map(o=>JSON.parse(o))}const re=E("main",{state:()=>({movieList:[],totalPages:0,loaded:!1}),getters:{finalMovieList(s){const t=Y().favoriteList.map(o=>o.kinopoiskId);return s.movieList.map(o=>t.includes(o.kinopoiskId)?{...o,favorite:!0}:{...o,favorite:!1})}},actions:{loadFilms(s,e){if(e===this.$state.totalPages)return;const t=e===1;t&&(this.$state.loaded=!0),ee.getCollections(e,s).then(o=>{t?(this.$state.movieList=o.items,this.$state.totalPages=o.totalPages,this.$state.loaded=!1):this.$state.movieList=ae([...this.$state.movieList,...o.items])})}}}),ie=v("div",{class:"bg-gradient-to-b from-transparent from-10% to-dark-bg to-100% h-1/2 w-full absolute left-0 bottom-0"},null,-1),le=v("div",{class:"bg-gradient-to-l from-transparent from-10% to-dark-bg to-100% w-1/2 h-full absolute left-0 bottom-0"},null,-1),ne={class:"text-4xl sm:text-6xl max-w-[500px] font-bold line-clamp-2"},ce={class:"max-w-[650px] text-lg line-clamp-3 sm:line-clamp-6"},ue={key:0},ve={key:1},me={key:2},de=S({__name:"moviePreview",props:{image:{},movie:{}},setup(s){const e=s,t=d(()=>e.movie.type==="FILM"?"Фильм":e.movie.type==="TV_SERIES"?"Сериал":e.movie.type==="MINI_SERIES"?"Мини-сериал":"Фильм или сериал"),o=f();return b(()=>{o.value&&(o.value.style.backgroundImage="url("+e.image+")")},()=>e.image),(P,i)=>{const c=q("router-link"),k=R;return n(),u("div",{ref_key:"posterHtmlEl",ref:o,class:"mb-10 relative bg-no-repeat bg-cover bg-center flex items-center w-full h-[65vh] sm:h-[90vh]"},[ie,le,g(k,{class:"relative z-10 flex flex-col gap-y-4 items-start"},{default:L(()=>[v("h1",ne,h(e.movie.name),1),v("h2",ce,h(e.movie.description),1),v("p",null,[e.movie.rating?(n(),u("span",ue,h(e.movie.rating)+" | ",1)):y("",!0),e.movie.year?(n(),u("span",ve,h(e.movie.year)+" | ",1)):y("",!0),e.movie.type?(n(),u("span",me,h(r(t)),1)):y("",!0)]),g(c,{class:"px-3 py-2 rounded-md text-lg text-white border-2 border-[#4a6fb5] transition-colors hover:bg-[#4a6fb5]",to:`/watch/${e.movie.kinopoiskId}`},{default:L(()=>[J(" Смотреть онлайн ")]),_:1},8,["to"])]),_:1})],512)}}}),pe={class:"rounded-xl overflow-hidden flex items-stretch gap-x-1"},fe=["value"],_e={class:"block p-4 border-black"},he=S({__name:"movieSelector",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(s){const e=f([{key:w.TOP_POPULAR_ALL,name:"Все"},{key:w.TOP_POPULAR_MOVIES,name:"Фильмы"},{key:w.POPULAR_SERIES,name:"Сериалы"}]),t=z(s,"modelValue");return(o,P)=>(n(),u("div",pe,[(n(!0),u(H,null,K(r(e),i=>(n(),u("label",{class:"has-[:checked]:bg-[#304c7a] block bg-[#4a6fb5] cursor-pointer transition-colors",key:i.key},[j(v("input",{"onUpdate:modelValue":P[0]||(P[0]=c=>t.value=c),class:"appearance-none absolute",value:i.key,type:"radio"},null,8,fe),[[G,t.value]]),v("span",_e,h(i.name),1)]))),128))]))}}),ge=E("preview",{state:()=>({previewMovie:p.get("previewMovie")||null,previewMoviePoster:p.get("previewPoster")||null,lastUpdate:p.get("lastUpdatePreview")||null}),actions:{setPreviewMovie(s,e){const t=Date.now();this.previewMovie=s,this.previewMoviePoster=e,this.lastUpdate=t,p.set("previewMovie",s),p.set("previewPoster",e),p.set("lastUpdatePreview",t)}}}),we={class:"flex flex-col items-center gap-y-5"},Se=S({__name:"index",setup(s){const e=Q(),t=re(),o=ge(),P=new te,i=f(""),c=d(()=>t.finalMovieList),k=d(()=>t.loaded),I=d(()=>o.previewMovie),O=d(()=>o.previewMoviePoster),m=f(w.TOP_POPULAR_ALL),D=d(()=>m.value===w.TOP_POPULAR_MOVIES?"Популярные фильмы":m.value===w.POPULAR_SERIES?"Популярные сериалы":"Популярные фильмы и сериалы"),_=f(1),M=f(!1),T=d(()=>t.totalPages),V=async()=>{const l=c.value[oe.random(1,20)];if(!l)return;const a=await P.getMovieImages(l.kinopoiskId);if(a.length<1){await V();return}o.setPreviewMovie(l,a[0].imageUrl)},$=f(!1);b(async()=>{const l=p.get("lastUpdatePreview")||null,a=l?se.getDifferenceDays(new Date,l):!0;!$.value&&c.value.length&&a&&($.value=!0,await V())},()=>c.value),b(()=>[m.value,_.value],(l,a)=>{if(a&&a[0]!==l[0]&&_.value>1&&(M.value=!0,_.value=1),M.value){M.value=!1;return}t.loadFilms(m.value,_.value)},{immediate:!0});const A=()=>{e.push({path:"/search",query:{s:i.value}})},C=()=>{T.value!==_.value&&_.value++};return W(()=>{i.value=""}),(l,a)=>{const N=F,B=R;return n(),u("div",null,[r(I)&&r(O)?(n(),X(de,{key:0,movie:r(I),image:r(O)},null,8,["movie","image"])):y("",!0),g(B,null,{default:L(()=>[v("section",we,[g(N,{class:"w-full sm:w-1/2",modelValue:r(i),"onUpdate:modelValue":a[0]||(a[0]=x=>U(i)?i.value=x:null),onSearch:A},null,8,["modelValue"]),g(he,{modelValue:r(m),"onUpdate:modelValue":a[1]||(a[1]=x=>U(m)?m.value=x:null)},null,8,["modelValue"]),g(Z,{"is-loaded":r(k),class:"self-stretch",title:r(D),"movie-list":r(c),onPagination:C},null,8,["is-loaded","title","movie-list"])])]),_:1})])}}});export{Se as default};
