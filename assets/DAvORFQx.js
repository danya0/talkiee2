import{_ as N}from"./BaCI30KF.js";import{_ as D}from"./Cnv9YCRJ.js";import{d as L,r as m,H as b,i as z,x as c,A as h,B as k,y as u,v as n,z as g,I as y,C as F,J as H,K,L as j,G as l,M as q,N as G,O as J,u as Q,j as f,F as W,P as R}from"./BPLFZt1L.js";import{M as w,L as p,u as X,K as Y}from"./hwuLnVGk.js";import{_ as Z}from"./fKHEAYGS.js";import"./DlAUqK2U.js";class ee{static random(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}}class te{static getDifferenceDays(e,t){const v=Math.abs(+e-+t);return Math.floor(v/(1e3*60*60*24))}}const oe=u("div",{class:"bg-gradient-to-b from-transparent from-10% to-dark-bg to-100% h-1/2 w-full absolute left-0 bottom-0"},null,-1),se=u("div",{class:"bg-gradient-to-l from-transparent from-10% to-dark-bg to-100% w-1/2 h-full absolute left-0 bottom-0"},null,-1),ae={class:"text-4xl sm:text-6xl max-w-[500px] font-bold"},le={class:"max-w-[650px] text-lg line-clamp-3 sm:line-clamp-6"},re={key:0},ne={key:1},ie={key:2},ce=L({__name:"moviePreview",props:{image:{},movie:{}},setup(s){const e=s,t=m();return b(()=>{t.value&&(t.value.style.backgroundImage="url("+e.image+")")},()=>e.image),(v,P)=>{const a=z("router-link"),i=D;return n(),c("div",{ref_key:"posterHtmlEl",ref:t,class:"mb-10 relative bg-no-repeat bg-cover bg-center flex items-center w-full h-[65vh] sm:h-[90vh]"},[oe,se,h(i,{class:"relative z-10 flex flex-col gap-y-4 items-start"},{default:k(()=>[u("h1",ae,g(e.movie.name),1),u("h2",le,g(e.movie.description),1),u("p",null,[e.movie.rating?(n(),c("span",re,g(e.movie.rating)+" | ",1)):y("",!0),e.movie.year?(n(),c("span",ne,g(e.movie.year)+" | ",1)):y("",!0),e.movie.type?(n(),c("span",ie,g(e.movie.type),1)):y("",!0)]),h(a,{class:"px-3 py-2 rounded-md text-lg text-white border-2 border-[#4a6fb5] transition-colors hover:bg-[#4a6fb5]",to:`/watch/${e.movie.kinopoiskId}`},{default:k(()=>[F(" Смотреть онлайн ")]),_:1},8,["to"])]),_:1})],512)}}}),ue={class:"rounded-xl overflow-hidden flex items-stretch gap-x-1"},ve=["value"],de={class:"block p-4 border-black"},pe=L({__name:"movieSelector",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(s){const e=m([{key:w.TOP_POPULAR_ALL,name:"Все"},{key:w.TOP_POPULAR_MOVIES,name:"Фильмы"},{key:w.POPULAR_SERIES,name:"Сериалы"}]),t=H(s,"modelValue");return(v,P)=>(n(),c("div",ue,[(n(!0),c(K,null,j(l(e),a=>(n(),c("label",{class:"has-[:checked]:bg-[#304c7a] block bg-[#4a6fb5] cursor-pointer transition-colors",key:a.key},[q(u("input",{"onUpdate:modelValue":P[0]||(P[0]=i=>t.value=i),class:"appearance-none absolute",value:a.key,type:"radio"},null,8,ve),[[G,t.value]]),u("span",de,g(a.name),1)]))),128))]))}}),me=J("preview",{state:()=>({previewMovie:p.get("previewMovie")||null,previewMoviePoster:p.get("previewPoster")||null,lastUpdate:p.get("lastUpdatePreview")}),actions:{setPreviewMovie(s,e){const t=Date.now();console.log("movie -> ",s),this.previewMovie=s,this.previewMoviePoster=e,this.lastUpdate=t,p.set("previewMovie",s),p.set("previewPoster",e),p.set("lastUpdatePreview",t)}}}),_e={class:"flex flex-col items-center gap-y-5"},xe=L({__name:"index",setup(s){const e=Q(),t=X(),v=me(),P=new Y,a=m(""),i=f(()=>t.finalMovieList),A=f(()=>t.loaded),U=f(()=>v.previewMovie),V=f(()=>v.previewMoviePoster),d=m(w.TOP_POPULAR_ALL),T=f(()=>d.value===w.TOP_POPULAR_MOVIES?"Популярные фильмы":d.value===w.POPULAR_SERIES?"Популярные сериалы":"Популярные фильмы и сериалы"),_=m(1),x=m(!1),E=f(()=>t.totalPages),O=async()=>{const r=i.value[ee.random(1,20)];if(!r)return;const o=await P.getMovieImages(r.kinopoiskId);if(o.length<1){await O();return}v.setPreviewMovie(r,o[0].imageUrl)},S=m(!1);b(async()=>{const r=p.get("lastUpdatePreview")||null,o=r?te.getDifferenceDays(new Date,r):!0;!S.value&&i.value.length&&o&&(S.value=!0,await O())},()=>i.value),b(()=>[d.value,_.value],(r,o)=>{if(o&&o[0]!==r[0]&&_.value>1&&(x.value=!0,_.value=1),x.value){x.value=!1;return}t.loadFilms(d.value,_.value)},{immediate:!0});const I=()=>{e.push({path:"/search",query:{s:a.value}})},$=()=>{E.value!==_.value&&_.value++};return(r,o)=>{const C=N,B=D;return n(),c("div",null,[l(U)&&l(V)?(n(),W(ce,{key:0,movie:l(U),image:l(V)},null,8,["movie","image"])):y("",!0),h(B,null,{default:k(()=>[u("section",_e,[h(C,{class:"w-full sm:w-1/2",modelValue:l(a),"onUpdate:modelValue":o[0]||(o[0]=M=>R(a)?a.value=M:null),onSearch:I},null,8,["modelValue"]),h(pe,{modelValue:l(d),"onUpdate:modelValue":o[1]||(o[1]=M=>R(d)?d.value=M:null)},null,8,["modelValue"]),h(Z,{"is-loaded":l(A),class:"self-stretch",title:l(T),"movie-list":l(i),onPagination:$},null,8,["is-loaded","title","movie-list"])])]),_:1})])}}});export{xe as default};
