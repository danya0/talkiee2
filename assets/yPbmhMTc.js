import{_ as N}from"./C3rUknD3.js";import{_ as A}from"./cGMhaccw.js";import{d as O,r as m,H as x,i as z,x as u,A as g,B as L,y as v,v as i,z as f,I as y,C as F,J as H,K,L as j,G as r,M as q,N as G,O as J,u as Q,j as _,F as W,P as D}from"./CCaU36JA.js";import{M as h,L as p,u as X,K as Y}from"./Bz3VbUAn.js";import{_ as Z}from"./Co_SA5RI.js";import"./DlAUqK2U.js";class ee{static random(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}}class te{static getDifferenceDays(t,e){const a=Math.abs(+t-+e);return Math.floor(a/(1e3*60*60*24))}}const oe=v("div",{class:"bg-gradient-to-b from-transparent from-10% to-dark-bg to-100% h-1/2 w-full absolute left-0 bottom-0"},null,-1),se=v("div",{class:"bg-gradient-to-l from-transparent from-10% to-dark-bg to-100% w-1/2 h-full absolute left-0 bottom-0"},null,-1),ae={class:"text-6xl max-w-[500px] font-bold"},re={class:"max-w-[650px] text-lg line-clamp-6"},le={key:0},ne={key:1},ie={key:2},ce=O({__name:"moviePreview",props:{image:{},movie:{}},emits:["watchOnline"],setup(s,{emit:t}){const e=s,a=m();return x(()=>{a.value&&(a.value.style.backgroundImage="url("+e.image+")")},()=>e.image),(w,l)=>{const c=z("router-link"),M=A;return i(),u("div",{ref_key:"posterHtmlEl",ref:a,class:"mb-10 relative bg-no-repeat bg-cover bg-center flex items-center w-full h-[90vh]"},[oe,se,g(M,{class:"relative z-10 flex flex-col gap-y-4 items-start"},{default:L(()=>[v("h1",ae,f(e.movie.name),1),v("h2",re,f(e.movie.description),1),v("p",null,[e.movie.rating?(i(),u("span",le,f(e.movie.rating)+" | ",1)):y("",!0),e.movie.year?(i(),u("span",ne,f(e.movie.year)+" | ",1)):y("",!0),e.movie.type?(i(),u("span",ie,f(e.movie.type),1)):y("",!0)]),g(c,{class:"px-3 py-2 rounded-md text-lg text-white border-2 border-[#4a6fb5] transition-colors hover:bg-[#4a6fb5]",to:`/watch/${e.movie.kinopoiskId}`},{default:L(()=>[F(" Смотреть онлайн ")]),_:1},8,["to"])]),_:1})],512)}}}),ue={class:"rounded-xl overflow-hidden flex items-stretch gap-x-1"},ve=["value"],de={class:"block p-4 border-black"},pe=O({__name:"movieSelector",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(s){const t=m([{key:h.TOP_POPULAR_ALL,name:"Все"},{key:h.TOP_POPULAR_MOVIES,name:"Фильмы"},{key:h.POPULAR_SERIES,name:"Сериалы"}]),e=H(s,"modelValue");return(a,w)=>(i(),u("div",ue,[(i(!0),u(K,null,j(r(t),l=>(i(),u("label",{class:"has-[:checked]:bg-[#304c7a] block bg-[#4a6fb5] cursor-pointer transition-colors",key:l.key},[q(v("input",{"onUpdate:modelValue":w[0]||(w[0]=c=>e.value=c),class:"appearance-none absolute",value:l.key,type:"radio"},null,8,ve),[[G,e.value]]),v("span",de,f(l.name),1)]))),128))]))}}),me=J("preview",{state:()=>({previewMovie:p.get("previewMovie")||null,previewMoviePoster:p.get("previewPoster")||null,lastUpdate:p.get("lastUpdatePreview")}),actions:{setPreviewMovie(s,t){const e=Date.now();console.log("movie -> ",s),this.previewMovie=s,this.previewMoviePoster=t,this.lastUpdate=e,p.set("previewMovie",s),p.set("previewPoster",t),p.set("lastUpdatePreview",e)}}}),_e={class:"flex flex-col items-center gap-y-5"},Me=O({__name:"index",setup(s){const t=Q(),e=X(),a=me(),w=new Y,l=m(""),c=_(()=>e.finalMovieList),M=_(()=>e.loaded),U=_(()=>a.previewMovie),V=_(()=>a.previewMoviePoster),d=m(h.TOP_POPULAR_ALL),T=_(()=>d.value===h.TOP_POPULAR_MOVIES?"Популярные фильмы":d.value===h.POPULAR_SERIES?"Популярные сериалы":"Популярные фильмы и сериалы"),P=m(1),b=m(!1),E=_(()=>e.totalPages),S=async()=>{const n=c.value[ee.random(1,20)];if(!n)return;const o=await w.getMovieImages(n.kinopoiskId);if(o.length<1){await S();return}a.setPreviewMovie(n,o[0].imageUrl)},R=m(!1);x(async()=>{const n=p.get("lastUpdatePreview")||null,o=n?te.getDifferenceDays(new Date,n):!0;!R.value&&c.value.length&&o&&(R.value=!0,await S())},()=>c.value),x(()=>[d.value,P.value],(n,o)=>{if(o&&o[0]!==n[0]&&(b.value=!0,P.value=1),b.value){b.value=!1;return}e.loadFilms(d.value,P.value)},{immediate:!0});const I=()=>{t.push({path:"/search",query:{s:l.value}})},$=()=>{E.value!==P.value&&P.value++};return(n,o)=>{const C=N,B=A;return i(),u("div",null,[r(U)&&r(V)?(i(),W(ce,{key:0,movie:r(U),image:r(V)},null,8,["movie","image"])):y("",!0),g(B,null,{default:L(()=>[v("section",_e,[g(C,{class:"w-full sm:w-1/2",modelValue:r(l),"onUpdate:modelValue":o[0]||(o[0]=k=>D(l)?l.value=k:null),onSearch:I},null,8,["modelValue"]),g(pe,{modelValue:r(d),"onUpdate:modelValue":o[1]||(o[1]=k=>D(d)?d.value=k:null)},null,8,["modelValue"]),g(Z,{"is-loaded":r(M),class:"self-stretch",title:r(T),"movie-list":r(c),onPagination:$},null,8,["is-loaded","title","movie-list"])])]),_:1})])}}});export{Me as default};
