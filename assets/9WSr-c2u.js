import{_ as R}from"./7LgbAimh.js";import{_ as T}from"./Cv1mPJWV.js";import{H as V,d as S,v as c,x as d,L as b,M as q,y as $,z as F,R as A,u as M,r as h,j as l,S as U,I as j,F as k,B as z,A as L,G as a,Q as D,J as g}from"./CFQ_Fs7C.js";import{_ as E}from"./DpUXKYii.js";import{k as G}from"./CdpP0kGF.js";import{L as y,u as J}from"./Cw9DUKrr.js";import"./DlAUqK2U.js";const K=10,Q=V("search",{state:()=>({searchList:[],searchListTotalPages:0,loaded:!1,searchHistory:y.get("searchHistory")||[]}),getters:{finalSearchList(o){const s=J().favoriteList.map(e=>e.kinopoiskId);return o.searchList.map(e=>s.includes(e.kinopoiskId)?{...e,favorite:!0}:{...e,favorite:!1})}},actions:{clearHistory(){this.searchHistory=[],y.removeItem("searchHistory")},writeToHistory(o){const t=this.searchHistory.findIndex(s=>s===o);if(t!==-1){this.searchHistory.push(...this.searchHistory.splice(t,1));return}this.searchHistory.length>=K&&this.searchHistory.shift(),this.searchHistory.push(o),y.set("searchHistory",this.searchHistory)},findByName(o,t){const s=o.trim();t===1&&(this.$state.loaded=!0),G.getByKeyword(s,t).then(e=>{t===1?(this.$state.loaded=!1,this.$state.searchList=e.items,this.$state.searchListTotalPages=Math.ceil(e.searchFilmsCountResult/t),this.writeToHistory(s)):this.$state.searchList=[...this.$state.searchList,...e.items]})}}}),O={class:"flex flex-wrap items-center gap-x-1 gap-y-1 mb-6"},W=$("span",null,"–ù–µ–¥–∞–≤–Ω–æ –∏—Å–∫–∞–ª–∏:",-1),X=["onClick"],Y=S({__name:"SearchHistory",props:{history:{}},emits:["clearHistory","research"],setup(o,{emit:t}){const s=t;return(e,r)=>(c(),d("div",O,[W,(c(!0),d(b,null,q(e.history,i=>(c(),d("span",{key:i,class:"text-white/70 inline-block hover:underline py-1 px-2 rounded-md bg-black/40 cursor-pointer",onClick:u=>s("research",i)},F(i),9,X))),128)),$("span",{class:"underline cursor-pointer text-white/80",onClick:r[0]||(r[0]=i=>s("clearHistory"))}," –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é ")]))}}),Z={key:1,class:"text-3xl xl:text-4xl text-center"},ne=S({__name:"index",setup(o){const t=A(),s=M(),e=h(""),r=Q(),i=l(()=>r.finalSearchList),u=l(()=>t.query.s),p=l(()=>r.loaded),v=h(!1),n=h(1),m=h(!1),w=l(()=>r.searchListTotalPages),_=l(()=>r.searchHistory.toReversed());U(()=>{u.value&&(e.value=`${u.value}`,f())});const f=()=>{e.value.trim()&&(n.value>1&&(n.value=1,m.value=!0),r.findByName(e.value,n.value),v.value=!0,s.push({query:{...t.query,s:e.value}}))},B=x=>{e.value=x,f()};j(()=>[n.value,u.value],()=>{if(m.value){m.value=!1;return}r.findByName(e.value,n.value)});const C=()=>{w.value<=n.value||n.value++};return(x,H)=>{const I=R,N=T;return c(),k(N,{class:"pt-24 flex flex-col items-center"},{default:z(()=>[L(I,{class:"w-full sm:w-1/2 mb-6",modelValue:a(e),"onUpdate:modelValue":H[0]||(H[0]=P=>D(e)?e.value=P:null),onSearch:f},null,8,["modelValue"]),a(_).length?(c(),k(Y,{key:0,history:a(_),onClearHistory:a(r).clearHistory,onResearch:B},null,8,["history","onClearHistory"])):g("",!0),L(E,{class:"self-stretch","movie-list":a(i),"is-loaded":a(p),onPagination:C},null,8,["movie-list","is-loaded"]),!a(i).length&&!a(p)&&a(v)?(c(),d("div",Z," –ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üò¢ ")):g("",!0)]),_:1})}}});export{ne as default};
